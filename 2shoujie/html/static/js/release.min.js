/*! demo 2015-02-09 */
function submitCaution(a){$("#"+a).parent("div").css({"background-color":"rgb(255,233,236)","border-color":"rgb(235,80,83)"}),$("#"+a).parent("div").addClass("form-alert")}function previewImage(a,b){if(a&&/image\//.test(a.type))if("image/gif"==a.type){var c=new mOxie.FileReader;c.onload=function(){b(c.result),c.destroy(),c=null},c.readAsDataURL(a.getSource())}else{var d=new mOxie.Image;d.onload=function(){d.downsize(140,140,!0);var a="image/jpeg"==d.type?d.getAsDataURL("image/jpeg",70):d.getAsDataURL();b&&b(a),d.destroy(),d=null},d.load(a.getSource())}}var catSelect=function(){var a=$(".goods-cat .form-value"),b=$(".goods-cat .form-value-l");a.children(".form-input-wr").click(function(){a.children(".select").css("display","block")}),a.children(".select").children("li").click(function(){var c=$(this).text(),d=$(this),e=d.attr("pk");$(this).parent("ul").parent("div").children("div").css("其他"!=c?{"background-color":"rgb(255,255,255)","border-color":"rgb(68,193,165)"}:{border:"1px solid rgb(208,224,226)","background-color":"rgb(246,249,249)"}),b.children(".select").children().removeClass("show"),b.children(".select").children("."+e).size()>0?(b.children(".select").children("."+e).addClass("show"),b.addClass("show")):b.removeClass("show"),a.children(".form-input-wr").children("span").text(c),$("#cat_l").val(""),b.children(".form-input-l-wr").children("span").text("未选择"),$("#cat").val(d.attr("value")),a.children(".select").css("display","none")}),b.children(".form-input-l-wr").click(function(){b.children(".select").addClass("show")}),b.children(".select").children("li").click(function(){var a=$(this).text();$("#cat_l").val(a),$(this).parent("ul").parent("div").children("div").css("其他"!=a?{"background-color":"rgb(255,255,255)","border-color":"rgb(68,193,165)"}:{border:"1px solid rgb(208,224,226)","background-color":"rgb(246,249,249)"}),b.children(".form-input-l-wr").children("span").text(a),b.children(".select").removeClass("show"),$("#cat_l").val($(this).attr("value"))}),$(document).click(function(){return $(event.srcElement).is(".goods-cat .form-value,.goods-cat .form-value *,goods-cat form-value-l,.goods-cat .form-value-l *")?!1:(a.children(".select").css("display","none"),void b.children(".select").removeClass("show"))})},addrSelect=function(){var a=$(".goods-place .form-value");a.children(".form-input-wr").click(function(){a.children("ul").css("display","block")}),a.children("ul").children("li").click(function(){var b=$(this).text();$(this).parent("ul").parent("div").children("div").css("其他"!=b?{"background-color":"rgb(255,255,255)","border-color":"rgb(68,193,165)"}:{border:"1px solid rgb(208,224,226)","background-color":"rgb(246,249,249)"}),a.children(".form-input-wr").children("span").text(b),$("#place").val(b),a.children("ul").css("display","none")}),$(document).click(function(){return $(event.srcElement).is(".goods-place .form-value,.goods-place .form-value *")?!1:void a.children(".select").css("display","none")})},discount=function(){$(".goods-discount .form-value .form-input-wr span").click(function(){var a=$(this).attr("data-value");$(".goods-discount .form-value .form-input-wr span").removeClass("sel"),$(this).addClass("sel"),$("#discount").val(a)})},act=function(){$(".form-value input,.form-value textarea").focus(function(){$(this).parent("div").css({"background-color":"rgb(255,255,255)","border-color":"rgb(68,193,165)"}),$(this).parent("div").removeClass("form-alert")}),$(".form-value input,.form-value textarea").blur(function(){$(this).parent("div").css(""==$(this).val()?{border:"1px solid rgb(208,224,226)","background-color":"rgb(246,249,249)"}:{"background-color":"rgb(255,255,255)","border-color":"rgb(68,193,165)"})})},submitAct=function(){$(".form-wr form").submit(function(){var a=$("#tel").val(),b=$("#price").val(),c=$("#title").val(),d=$("#qq").val(),e=$("#desc").val(),f=1;return""==b&&(submitCaution("price"),f=0),""==c&&(submitCaution("title"),f=0),""==e&&(submitCaution("desc"),f=0),a.match(/^1[3|4|5|8][0-9]\d{4,8}$/)||(submitCaution("tel"),f=0),d.match(/^[1-9]d{4,8}$/)||(submitCaution("qq"),f=0),0==f?!1:!0})},selectPhoto=function(){$(".camera-button").click(function(){$(this).parent("div").css("display","none"),$(".gallery").css("display","block")})};$(document).ready(function(){act(),selectPhoto(),catSelect(),addrSelect(),discount(),submitAct(),0!=$(".upload-area").children(".photo").size()&&($(".photo-area").removeClass("init-up").addClass("over-up"),$("#upload").children("span").eq(0).removeClass("up-bg").addClass("upload-img"),$(".up-img-bg").addClass("hide"),4==$(".upload-area").children(".photo").size()&&($("#upload").closest("div").addClass("hide"),$(".moxie-shim").addClass("hide")))}).on("click",".close",function(){$(this).parent("div").remove(),$("#upload").closest("div").hasClass("hide")&&($("#upload").closest("div").removeClass("hide"),$(".moxie-shim").removeClass("hide")),$(".moxie-shim").css({width:$("#upload").width(),height:$("#upload").height(),left:$("#upload").closest("div").position().left,top:$("#upload").closest("div").position().top}),0==$(".upload-area").children(".photo").size()&&($(".photo-area").removeClass("over-up").addClass("init-up"),$("#upload").children("span").eq(0).removeClass("upload-img").addClass("up-bg"),$(".up-img-bg").removeClass("hide"))}).on("mouseenter",".moxie-shim input",function(){$(".upload-img").addClass("upload-img-hover")}).on("mouseleave",".moxie-shim input",function(){$(".upload-img").removeClass("upload-img-hover")}),$(function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload",container:"upload-area",drop_element:"upload-area",max_file_size:"5mb",filters:{max_file_size:"5mb",mime_types:[{title:"image type",extensions:"jpg,jpeg,gif,png"}]},flash_swf_url:"static/js/plupload/Moxie.swf",dragdrop:!1,chunk_size:"5mb",domain:"http://ershou.u.qiniudn.com/",uptoken:"hyA3Svs21nO-wJsXWMdpZMkRz9NrzYZOKRx76Pwm:yHNK-UgUUp0yyc98sVWAbsMuCJw=:eyJzY29wZSI6ImVyc2hvdSIsImRlYWRsaW5lIjoxNDIzMDI4NjAxfQ==",unique_names:!1,save_key:!1,auto_start:!0,init:{FilesAdded:function(a,b){var c=b[0];0==$(".upload-area").children(".photo").size()&&($(".photo-area").removeClass("init-up").addClass("over-up"),$("#upload").children("span").eq(0).removeClass("up-bg").addClass("upload-img"),$(".up-img-bg").addClass("hide"));var d=$('<div class="photo"><div><img width="140" height="140" src="" alt="" class="image"></div><span class="close"></span><div class="processbar" id="'+c.id+'" style="width: 0%;"></div></div>');$("#upload").closest("div").before(d),4==$(".upload-area").children(".photo").size()&&($("#upload").closest("div").addClass("hide"),$(".moxie-shim").addClass("hide")),$(".moxie-shim").css({left:$("#upload").closest("div").position().left,top:$("#upload").closest("div").position().top}),!function(){previewImage(c,function(a){$("#"+c.id).closest(".photo").find("img").attr("src",a)})}()},UploadProgress:function(a,b){$("#"+b.id).css("width",b.percent+"%")},FileUploaded:function(a,b,c){$("#"+b.id).addClass("hide"),$("#"+b.id).closest(".photo").find("img").attr("url","http://ershou.u.qiniudn.com/"+$.parseJSON(c).key)},Error:function(a,b){alert(-600==b.code?"图片大小不能超过5M哦":-601==b.code?"图片格式不对哦":-200==b.code?"上传出错":b.code+": "+b.message),a.removeFile(b.file.id),$("#"+b.file.id).closest(".photo").remove(),3==$(".upload-area").children(".photo").size()&&($("#upload").closest("div").removeClass("hide"),$(".moxie-shim").removeClass("hide")),0==$(".upload-area").children(".photo").size()&&($(".photo-area").removeClass("over-up").addClass("init-up"),$("#upload").children("span").eq(0).removeClass("upload-img").addClass("up-bg"),$(".up-img-bg").removeClass("hide")),$(".moxie-shim").css({left:$("#upload").closest("div").position().left,top:$("#upload").closest("div").position().top})},Key:function(a,b){var c="Web_"+(new Date).getTime()+"_"+b.id;return c}}});setTimeout(function(){$(".moxie-shim").children("input").attr("capture","camera").attr("accept","image/*").removeAttr("multiple")},500)});